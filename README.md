# MiniMax 音色管理器

基于 Streamlit 的 MiniMax 音色管理工具，提供直观的 Web 界面来管理你的音色。

## 功能特性

### 🎤 测试音色（默认页面）
- 选择任意音色进行测试
- 自定义测试文本
- 调整音频参数（语速、音量、音调）
- 实时播放和下载生成的音频
- 智能搜索功能快速查找音色

### 📋 音色列表
- 查看所有克隆音色
- 显示音色状态（准备中/就绪/错误）
- 一键删除音色
- 自动刷新音色列表

### 🎭 系统音色测试
- 测试MiniMax预设的系统音色
- 动态获取API中的最新系统音色
- 智能搜索功能快速查找音色（支持ID、名称、描述搜索）
- 搜索结果显示提示和下拉菜单联动
- 查看所有可用系统音色列表
- 支持情感参数设置
- 实时播放和下载生成的音频

### ➕ 添加音色
- 上传音频文件（支持 WAV、MP3、M4A、FLAC）
- 自定义音色ID
- 高级选项配置（降噪、音量标准化等）
- 实时状态反馈

### 📁 批量上传
- 同时上传多个音频文件
- 批量配置音色参数
- 自定义每个文件的音色ID和预览文本
- 支持从CSV文件导入配置
- 批量处理进度显示

### 📊 Excel集成功能
- 自动加载指定Excel文件内容
- 智能搜索功能，支持任意列内容搜索
- 点击行选择数据自动填充测试信息
- 自动将中文文本转换为拼音搜索音色
- 自动设置测试文本和文件名前缀
- 支持法语剧本等特定格式的Excel文件
- 性能优化，避免大量数据导致页面卡顿

## 安装和运行

### 方法一：使用 uv 启动脚本（推荐）

```bash
# 在项目根目录下运行
uv run python tools/run_simple.py
```

### 方法二：手动运行

```bash
# 1. 安装依赖（可选，uv会自动处理）
uv add streamlit pandas

# 2. 运行应用
uv run streamlit run tools/app.py
```

### 方法三：通用启动脚本

```bash
# 使用通用启动脚本（自动检测uv环境）
python tools/run_app.py
```

## 使用说明

### 1. 配置连接
1. 打开应用后，在左侧边栏输入你的 MiniMax API Key 和 Group ID
2. 点击"连接"按钮
3. 连接成功后即可使用所有功能

### 2. 测试音色（默认功能）
1. 应用启动后默认显示"测试音色"页面
2. 使用搜索框快速找到想要的音色
3. 选择要测试的音色
4. 输入测试文本
5. 调整音频参数
6. 点击"生成测试音频"
7. 播放或下载生成的音频

### 3. 查看音色列表
- 在"音色列表"标签页查看所有克隆音色
- 可以删除不需要的音色
- 点击"刷新音色列表"更新状态

### 4. 系统音色测试
1. 在"系统音色"标签页查看所有可用的系统音色
2. 点击"获取最新系统音色"按钮从API动态获取最新音色
3. 使用搜索框快速查找特定音色（支持按ID、名称或描述搜索）
4. 搜索结果会实时显示在下拉菜单中，并有明确的提示信息
5. 选择要测试的系统音色
6. 输入测试文本并调整音频参数
7. 选择情感设置（可选）
8. 点击"生成测试音频"
9. 播放或下载生成的音频
10. 使用"清除API音色"按钮可以重置为基础音色
11. 使用"清除搜索"按钮可以快速重置搜索条件

### 5. 添加单个音色
1. 在"添加音色"标签页上传音频文件
2. 设置音色ID（必须符合格式要求）
3. 配置高级选项（可选）
4. 点击"开始克隆"
5. 等待处理完成

### 6. 批量上传音色
1. 在"批量上传"标签页选择多个音频文件
2. 设置基础音色ID或自定义每个文件的音色ID
3. 为每个文件设置预览文本（可选）
4. 可选择从CSV文件导入配置（参考 `batch_config_template.csv`）
5. 配置批量参数
6. 点击"开始批量克隆"
7. 查看处理进度和结果

### 7. Excel集成功能
1. 在页面顶部查看自动加载的Excel表格数据
2. 使用搜索框输入关键词过滤数据（支持任意列搜索）
3. 点击任意行的"选择"按钮
4. 系统会自动：
   - 将第三列中文文本转换为拼音并搜索音色
   - 将第五列内容填入测试文本
   - 设置文件名前缀为第一列（去掉冒号）
5. 自动跳转到"测试音色"页面（默认页面）进行音频生成
6. 下载的文件名会自动包含选择的行标识
7. 使用"清除选择"按钮可以重置所有自动填充的内容
8. 使用"清除搜索"按钮可以重置搜索条件

## 音色ID格式要求

- 至少8位字符
- 必须以字母开头
- 必须包含字母和数字
- 示例：`voice001`、`myVoice123`、`testVoice456`

## 系统音色

MiniMax提供以下预设系统音色，无需克隆即可直接使用：

### 基础系统音色
- **智慧女性** (Wise_Woman)
- **友好人士** (Friendly_Person)
- **励志女孩** (Inspirational_girl)
- **深沉男声** (Deep_Voice_Man)
- **平静女性** (Calm_Woman)
- **随性男士** (Casual_Guy)
- **活泼女孩** (Lively_Girl)
- **耐心男士** (Patient_Man)
- **年轻骑士** (Young_Knight)
- **坚定男士** (Determined_Man)
- **可爱女孩** (Lovely_Girl)
- **体面男孩** (Decent_Boy)
- **威严仪态** (Imposing_Manner)
- **优雅男士** (Elegant_Man)
- **女修道院长** (Abbess)
- **甜美女孩2** (Sweet_Girl_2)
- **热情女孩** (Exuberant_Girl)

### 动态获取音色
- 点击"获取最新系统音色"按钮可以从API动态获取最新的系统音色
- 动态获取的音色会与基础音色合并显示
- 支持查看音色来源（基础/API）
- 可以随时清除API获取的音色，回到基础音色列表

## 支持的音频格式

- **WAV** - 无损音频格式
- **MP3** - 有损压缩格式
- **M4A** - AAC编码格式
- **FLAC** - 无损压缩格式

## 音频参数说明

### 测试音频参数
- **语速**: 0.5-2.0，1.0为正常速度
- **音量**: 0-10，1.0为正常音量
- **音调**: -12到12，0为正常音调
- **情感**: 选择语音的情感表达（happy, sad, angry, fearful, disgusted, surprised, neutral）
- **语言增强**: 提高特定语言的发音质量（Chinese, English, French, German, Spanish, Italian, Japanese, Korean, Russian, Arabic, Portuguese, Turkish, Dutch, Ukrainian, Vietnamese, Indonesian, Thai, Polish, Romanian, Greek, Czech, Finnish, Hindi, auto）
- **模型**: 选择不同的TTS模型

### 克隆参数
- **降噪**: 是否启用音频降噪
- **音量标准化**: 是否标准化音量
- **文本验证精度**: 0-1，用于验证音色质量
- **模型**: 选择克隆使用的模型
- **预览文本**: 用于验证音色质量的文本（可选）

## CSV导入功能

### CSV文件格式
CSV文件应包含以下列：
- **文件名**: 音频文件的完整文件名（包括扩展名）
- **音色ID**: 对应的音色ID
- **预览文本**: 用于验证音色的文本（可选）

### 示例CSV文件
```csv
文件名,音色ID,预览文本
sample1.wav,voice001,你好，这是第一个测试音频。
sample2.mp3,voice002,Hello, this is the second test audio.
sample3.m4a,voice003,这是一个中文测试音频，用于验证音色质量。
```

### 使用步骤
1. 准备CSV文件，确保文件名与上传的音频文件完全匹配
2. 在批量上传页面选择音频文件
3. 点击"从CSV导入配置"上传CSV文件
4. 系统会自动填充音色ID和预览文本
5. 可以手动调整任何配置
6. 开始批量克隆

## 注意事项

1. **API限制**: 请确保你的API配额足够
2. **文件大小**: 建议音频文件不超过50MB
3. **处理时间**: 音色克隆通常需要1-5分钟
4. **网络连接**: 需要稳定的网络连接
5. **浏览器兼容**: 建议使用Chrome、Firefox或Edge
6. **CSV编码**: 确保CSV文件使用UTF-8编码
7. **Excel文件**: 确保Excel文件路径正确且格式符合要求
8. **拼音转换**: 需要安装pypinyin库支持中文转拼音功能

## 故障排除

### 连接失败
- 检查API Key和Group ID是否正确
- 确认网络连接正常
- 验证API配额是否充足

### 上传失败
- 检查文件格式是否支持
- 确认文件大小不超过限制
- 验证文件是否损坏

### 克隆失败
- 检查音色ID格式是否正确
- 确认音频文件质量良好
- 查看错误信息进行相应处理

### Excel加载失败
- 检查Excel文件路径是否正确
- 确认文件格式为.xlsx
- 验证文件是否被其他程序占用
- 检查文件权限

### 页面卡顿
- 使用搜索功能过滤数据，避免显示过多行
- 搜索结果超过50行时会自动限制显示
- 使用更具体的搜索关键词
- 清除搜索条件重新开始

### 拼音转换失败
- 确认已安装pypinyin库
- 检查中文文本格式是否正确
- 查看控制台错误信息

## 开发说明

### 项目结构
```
tools/
├── app.py                        # 主应用文件
├── run_app.py                    # 通用启动脚本
├── run_uv.py                     # uv专用启动脚本
├── run_simple.py                 # 简单启动脚本
├── requirements.txt              # 依赖文件
├── batch_config_template.csv     # CSV配置模板
├── README.md                     # 说明文档
├── components/                   # 组件目录
│   ├── __init__.py              # 组件包初始化
│   ├── voice_manager.py         # 音色管理器核心类
│   └── sidebar.py               # 侧边栏组件
└── pages/                       # 页面目录
    ├── __init__.py              # 页面包初始化
    ├── voice_list.py            # 音色列表页面
    ├── test_voice.py            # 测试音色页面
    ├── add_voice.py             # 添加音色页面
    └── batch_upload.py          # 批量上传页面
```

### 技术栈
- **Streamlit**: Web界面框架
- **MiniMax Speech SDK**: 音色管理API
- **Python**: 后端逻辑

### 扩展功能
如需添加新功能，可以修改 `voice_manager.py` 文件：
- 添加新的标签页
- 扩展音色管理功能
- 优化用户界面
- 添加数据导出功能

## 许可证

本项目遵循与主项目相同的许可证。 